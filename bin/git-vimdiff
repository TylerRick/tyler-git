#!/usr/bin/ruby

require 'fileutils'

if ARGV.size < 1
  puts "Usage: #{$0} path"
  puts <<End
Compare your working tree version with the HEAD version and interactively revert (copy from HEAD) changes you have made
This shows you the same thing as git diff but it's interactive: it lets you edit the file even while you're looking at the diff!
Useful if you overwrite your working version with a generated version (generated by the rails command, f.e.) and you want to incorporate some of the changes
from the generated version without losing what you had before. Well, during the overwrite you *will* lose what you had before (answer yes to overwrite), but this command lets you 
quickly get it back.
Somewhat similar to git mergetool (when using vimdiff)
End
  exit 1
end

cat_save_output = `git cat-save #{ARGV[0]}`
saved_as = cat_save_output[cat_save_output.rindex('>')+1 .. -1].strip

system "vimdiff #{saved_as} #{ARGV[0]}"
FileUtils.rm saved_as

#---------------------------------------------------------------------------------------------------
# Original bash function version:
#
#if [ $# -lt 1 ]; then
#  echo "Usage: $0 path"
#  exit 1
#fi
#function git-vimdiff()      { 
#  git-cat-save $1
#  vimdiff $saved_as $1
#  rm $saved_as
#}
